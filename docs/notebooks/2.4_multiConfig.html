<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sydney Informatics Hub training - 2.4. Using multiple configuration files at once</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Sydney Informatics Hub training</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup.html">
 <span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notebooks/0.0_welcome.html">
 <span class="menu-text">Lesson plan</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-1">    
        <li>
    <a class="dropdown-item" href="../notebooks/1.0_intro.html">
 <span class="dropdown-text">1.0 Session 1 kick-off</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.1_nextflow.html">
 <span class="dropdown-text">1.1 Introduction to Nextflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.2_nfcore.html">
 <span class="dropdown-text">1.2 Introduction to nf-core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.3_configure.html">
 <span class="dropdown-text">1.3 Configuring nf-core workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.4_users.html">
 <span class="dropdown-text">1.4 Commands for users</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-2">    
        <li>
    <a class="dropdown-item" href="../notebooks/2.0_intro.html">
 <span class="dropdown-text">2.0 Session 2 kick-off</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.1_design.html">
 <span class="dropdown-text">2.1 Design a run command</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.2_params.html">
 <span class="dropdown-text">2.2 Use a parameters file</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.3_configEnv.html">
 <span class="dropdown-text">2.3 Configure resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.4_multiConfig.html">
 <span class="dropdown-text">2.4 Apply multiple configurations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.5_extArgs.html">
 <span class="dropdown-text">2.5 Apply external arguments</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../tips_tricks.html">
 <span class="menu-text">Tips &amp; Tricks</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#configure-your-run-to-use-a-non-default-container" id="toc-configure-your-run-to-use-a-non-default-container" class="nav-link active" data-scroll-target="#configure-your-run-to-use-a-non-default-container"><strong>2.4.1. Configure your run to use a non-default container</strong></a></li>
  <li><a href="#customised-resource-tracing" id="toc-customised-resource-tracing" class="nav-link" data-scroll-target="#customised-resource-tracing"><strong>2.4.2. Customised resource tracing</strong></a></li>
  <li><a href="#configure-multiqc-reports" id="toc-configure-multiqc-reports" class="nav-link" data-scroll-target="#configure-multiqc-reports"><strong>2.4.3. Configure MultiQC reports</strong></a></li>
  <li><a href="#apply-external-arguments" id="toc-apply-external-arguments" class="nav-link" data-scroll-target="#apply-external-arguments"><strong>2.4.4. Apply external arguments</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>2.4. Using multiple configuration files at once</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Create and apply a custom configuration file for over-riding default containers</li>
<li>Create and apply a custom configuration file for resource tracing</li>
<li>Create and apply a custom configuration file for MultiQC</li>
<li>Create and apply a custom configuration that supplies tool arguments that are not available as nf-core parameters</li>
<li>Apply multiple custom configuration files in a single workflow execution with <code>-c &lt;conf-1,conf2,...&gt;</code></li>
</ul>
</div>
</div>
<p>Using multiple configuration files allows you to customise nf-core pipelines to your specific needs. Depending on how you work, where you work, and what pipelines you run, you may have configuration files that: - Handle distinct issues - Can be applied to specific infrastructures - Can be shared by multiple nf-core pipelines</p>
<p>In this lesson we will create three custom configuration files that affect different aspects of the workflow and apply them to the one run command.</p>
<section id="configure-your-run-to-use-a-non-default-container" class="level3">
<h3 class="anchored" data-anchor-id="configure-your-run-to-use-a-non-default-container"><strong>2.4.1. Configure your run to use a non-default container</strong></h3>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that for deploying nf-core workflows, it is not recommended to replace the tools within the workflow, as this will decrease portability and reproducibilty! This exercise is to demonstrate how you can specify containers, as this may aid you in developing and testing your own Nextflow workflows</p>
</div>
</div>
<p>For this example, we are going to test out the latest version of <a href="https://github.com/FelixKrueger/TrimGalore">Trim Galore</a>. We have been using the default version of Trim Galore that is executed with nf-core/rnaseq revision 3.11.1.</p>
<p>We can easily view the versions of all tools used from the <code>software_versions.yml</code> file created by default in the <code>&lt;outdir&gt;/pipeline_info</code> directory by nf-core workflows <em>OR</em> by viewing the same information from the ‘nf-core/rnaseq Software Versions’ section of the MultiQC html report.<br>
<br></p>
<p>➤ Identify the version of Trim Galore that has been used in our runs so far from the <code>software_versions.yml</code> file.</p>
<blockquote class="blockquote">
<p>You might view the file by opening it from the VS Code explorer pane, using <code>more</code> command, or <code>grep</code> for the tool name.</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>more Lesson-2.3.4/pipeline_info/software_versions.yml</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>##</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>#TRIMGALORE:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>#  cutadapt: '3.4'</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>#  trimgalore: 0.6.7</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>#</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The process names are listed in alphabetical order, with the tools and versions used in the <code>script</code> section of the process listed below the process name. We can see for TRIMGALORE process that version 0.6.7 of Trim Galore was used. <br><br></p>
<p>There is a <a href="https://github.com/FelixKrueger/TrimGalore/releases/tag/0.6.10">newer version of Trim Galore</a> available, version 0.6.10. Recall that we have been accessing some materials on <a href="https://support.pawsey.org.au/documentation/pages/viewpage.action?pageId=92832676#NimbusforBioinformatics-1.BiocontainersandReferenceGenomedata"><strong>CernVM-FS</strong></a>, a read-only filesystem which provides shared access to common bioinformatics reference datasets as well as Singularity containers of everything stored in <a href="https://biocontainers.pro/">Biocontainers</a>.</p>
<p>CernVM-FS comes pre-mounted on Pawsey Nimbus VMs using the <a href="https://support.pawsey.org.au/documentation/display/US/Nimbus+for+Bioinformatics#"><strong>Pawsey Bio - Ubuntu 22.04 - 2023-03</strong></a> image, so we can access and apply the Trim Galore biocontainer by specifying the path to this remote image within the process scope of a custom config, using the ‘withName’ process selector.</p>
<p>We could just as easily specify an alternate remote source, such as <a href="https://quay.io/organization/biocontainer">quay.io</a>, or point to a local image.</p>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Thoughts</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="emoji" data-emoji="question">❓</span> For maintaining best practice, where is the best place for the container definition?</p>
<ol type="a">
<li><p>Within the <code>custom-nimbus.config</code> institutional config file</p></li>
<li><p>Within a separate custom config file named eg <code>custom-tools.config</code></p></li>
</ol>
<p>Why do you think this?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Remember, Nextflow’s portability is achieved by separating <strong>workflow implementation</strong> from the <strong>configuration settings</strong> required to execute it. In the event that we are testing a different tool version, this should <strong>not</strong> be placed within the institutional config that is shareable with others using the same infrastructure. Swapping out tool versions is a bespoke adaptation of the nf-core workflow that could harm reproducibility if it was inadvertently executed. By placing it within a clearly named custom config file, there is less chance of unwittingly executing a workflow that does not match the expected utilisation of tools.</p>
</div>
</div>
</div>
<p><br></p>
<p>➤ First, identify the container for the 0.6.10 version of Trim Galore:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>Containers are mounted at the path <code>/cvmfs/singularity.galaxyproject.org</code>, with sub-directories based on the first 2 letters of the tool name, eg <code>/cvmfs/singularity.galaxyproject.org/t/r/</code> for Trim Galore containers.</p>
</div>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ls /cvmfs/singularity.galaxyproject.org/t/r/trim*</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>##</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>#  /cvmfs/singularity.galaxyproject.org/t/r/trim-galore:0.6.10--hdfd78af_0</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>##</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ Next, identify the execution path for the TRIM_GALORE module:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>grep -i galore nf-core-rnaseq-3.11.1/workflow/conf/modules.config </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>##</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>#    if (params.trimmer == 'trimgalore') {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>#            withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:FASTQC' {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>#    if (params.trimmer == 'trimgalore') {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>#            withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>#                        params.extra_trimgalore_args ? params.extra_trimgalore_args.split("\\s(?=--)") : ''</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>##</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ Open a file for editing named <code>custom-tools.config</code>, and start building your config with the process scope and ‘withName’ selector that we covered in <a href="../notebooks/2.3_configEnv.html#2.3.5.-custom-resource-configuration-using-process-names">Session 2.3</a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  withName: {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ Then copy the Trim Galore module execution path:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ Finally, copy the container details:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    container = '/cvmfs/singularity.galaxyproject.org/t/r/trim-galore:0.6.10--hdfd78af_0' </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ Execute the run supplying our two configuration files:</p>
<ul>
<li>When adding multiple custom configs, we apply them to <code>-c</code> in a comma-delimited list</li>
<li>If you haven’t already done so, delete or comment out the ‘withName’ resource content we applied to the STAR_ALIGN process in the <code>custom-nimbus.config</code> file</li>
<li>Specify output directory <code>Lesson-2.4.1</code></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a> nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,custom-tools.config \</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.1 \</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  -resume </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ After your run has completed, check that the updated version of Trim Galore has been used:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>grep -i galore Lesson-2.4.1/pipeline_info/software_versions.yml</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>##</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>#TRIMGALORE:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>#  trimgalore: 0.6.10</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>##</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
</section>
<section id="customised-resource-tracing" class="level3">
<h3 class="anchored" data-anchor-id="customised-resource-tracing"><strong>2.4.2. Customised resource tracing</strong></h3>
<p>Running Nextflow workflows with the flag <code>-with-trace</code> writes a <a href="https://www.nextflow.io/docs/latest/tracing.html#trace-report">trace report</a> named <code>trace.txt</code> in the working directory.</p>
<p>nf-core pipelines by default create an <code>execution_trace</code> file within <code>&lt;outdir&gt;/pipeline_info</code>, with the default fields that Nextflow <code>-with-trace</code> applies. A trace report can be customised to include any combination of <a href="https://www.nextflow.io/docs/latest/tracing.html#trace-fields">available fields</a> using the Nextflow <code>-fields</code> flag.</p>
<p>In this exercise, we will create a custom configuration file that writes a detailed resource tracing file including our customised fields.</p>
<p>To begin, we will extract these custom fields from a previous run using the <code>nextflow log</code> command.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Challenge</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the <a href="https://www.nextflow.io/docs/latest/tracing.html#trace-fields">trace report fields</a>, write a <code>nextflow log</code> command to query the following for a previous workflow run:</p>
<ul>
<li>Task <strong>name</strong></li>
<li>Task <strong>status</strong></li>
<li>Task <strong>exit</strong> status</li>
<li>Task execution time (<strong>realtime</strong>)</li>
<li>Number of <strong>cpus</strong> requested for the task</li>
<li>Percentage of CPU used by the process (<a href="https://github.com/nextflow-io/nextflow/issues/3893#event-9076291921">use <strong>pcpu</strong> rather than <strong>%cpu</strong></a>)</li>
<li>Amount of <strong>memory</strong> requested for the task</li>
<li>Percentage of memory used by the process (<a href="https://github.com/nextflow-io/nextflow/issues/3893#event-9076291921">use <strong>pmem</strong> rather than <strong>%mem</strong></a>)</li>
<li>Resident set size of the process (<strong>rss</strong>)</li>
</ul>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First, run <code>nextflow log</code> with no arguments to obtain the name of your last run (unless you can remember it!)</p>
<p>Then, supply that run name to the command below:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>nextflow log &lt;run_name&gt; -f name,status,exit,realtime,cpus,pcpu,memory,pmem,rss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
<p>If there is a specific combination of fields you would like to regularly capture for your pipeline runs, perhaps for <a href="https://www.nature.com/articles/s41467-019-09406-4">resource benchmarking</a>, it would be useful to have a custom configuration file that can be optionally applied to any run.</p>
<p>Let’s make a portable configuration file for resource tracing. Because this config is not infrastructure or pipeline specific, we can share it with collaborators and use it across multiple pipelines. <br></p>
<p>➤ Open a file for editing called <code>custom-trace.config</code> and add the following content:</p>
<blockquote class="blockquote">
<p>Note that we need to use <code>%cpu</code> and <code>%mem</code>, as per the <a href="https://www.nextflow.io/docs/latest/tracing.html#trace-fields">Nextflow documentation</a> and not <code>pcpu</code> and <code>pmem</code> as we applied on the command line according to this <a href="https://github.com/nextflow-io/nextflow/issues/3893#event-9076291921">issue</a>.</p>
</blockquote>
<div class="sourceCode" id="cb10"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>// Define timestamp, to avoid overwriting existing trace </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>def trace_timestamp = new java.util.Date().format('yyyy-MM-dd_HH-mm-ss')</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>// Generate custom resource trace file </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>trace {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  enabled = true </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  file = "${params.outdir}/custom-resource-trace-${trace_timestamp}.txt"</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  fields = 'name,status,exit,realtime,cpus,%cpu,memory,%mem,rss'</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ Resume your previous run, adding <code>custom-trace.config</code> and specifying output directory Lesson-2.4.2:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,custom-tools.config,custom-trace.config \</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.2 \</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  -resume </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p><span class="emoji" data-emoji="eyes">👀</span> Notice that your multiple custom configurations are listed under <strong>Core Nextflow options</strong> on the launch log printed to the screen: <br><br> <img src="../figs/2.4_screenshot_config_list.png" class="img-fluid"> <br><br></p>
<p>➤ Once the workflow has run, take a look at the <code>&lt;outdir&gt;/custom-resource-trace-${trace_timestamp}.txt</code> file:</p>
<p><img src="../figs/2.4_screenshot_custom_trace.png" class="img-fluid"> <br><br></p>
</section>
<section id="configure-multiqc-reports" class="level3">
<h3 class="anchored" data-anchor-id="configure-multiqc-reports"><strong>2.4.3. Configure MultiQC reports</strong></h3>
<p>Many nf-core pipelines use <a href="https://multiqc.info/docs/">MultiQC</a> to generate a summary report at the end of a workflow. MultiQC is a reporting tool that can aggregate results and statistics output by various bioinformatics tools, helping to summarise experiments containing multiple samples and multiple analysis steps.</p>
<p>MultiQC allows users the flexibility of <a href="https://multiqc.info/docs/reports/customisation/">customising the output reports</a>.</p>
<p>nf-core has enabled users to take full advantage of this functionality through the inclusion of the <a href="https://nf-co.re/rnaseq/3.11.1/parameters#multiqc_config"><code>--multiqc_config</code> parameter</a>.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>--multiqc_config</code> parameter is a <strong>‘hidden param’!</strong> To see this parameter, you need to apply <code>--show_hidden_params</code> on the command line help, or select ‘Show hidden params’ on the nf-core parameters webpage.</p>
</div>
</div>
<p><br></p>
<p>We are going to configure MultiQC to:</p>
<ul>
<li>Aid interpretation of the FastQC “Per Sequence GC Content” plot by overlaying a <a href="https://multiqc.info/modules/fastqc/#theoretical-gc-content">theoretical GC content track</a> specific for our mm10 reference genome</li>
<li>Add a custom report header <br><br></li>
</ul>
<p>➤ Open a file for editing named <code>custom-multiqc-config.yaml</code> and add the following content:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can add any fields under the <code>report_header_info</code> section, as long as you follow the required formatting</p>
</div>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a># Project level information:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>report_header_info:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  - Contact E-mail: "cali.willet@sydney.edu.au"</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  - Workshop host: "Australian BioCommons"</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  - Workshop title: "Unlocking nf-core - customising workflows for your research"</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  - Workshop URL: https://sydney-informatics-hub.github.io/customising-nfcore-workshop/</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a># Theoretical GC Content:</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>fastqc_config:  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  fastqc_theoretical_gc: "mm10_txome" </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ To the <code>workshop-params.yaml</code> file, add:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>multiqc_config: "custom-multiqc-config.yaml" </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ Make sure both YAML files are saved, then re-run the workflow:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that we do not need to add our MultiQC config at <code>-c</code> because we have specified it within the custom parameters YAML file.</p>
</div>
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,,custom-tools.config,custom-trace.config \</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.3 \</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  -resume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>➤ View the html file <code>Lesson-2.4.2/multiqc/star_salmon/multiqc_report.html</code> and compare it to the report generated by a previous run</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>If you are using VS Code with the ‘Live Server’ extension installed, right click the html file in the Explorer pane and select ‘Open with Live Server’</li>
<li>If you are using a terminal without a browser GUI enabled, use eg <code>scp</code> command to take a copy to your local computer and open in your preferred browser</li>
</ul>
</div>
</div>
<p>Navigate to the section titled <strong>FastQC: Per Sequence GC Content</strong>. Compare the two plots to observe the custom track has been successfully added.</p>
<p><img src="../figs/2.4_MultiQC.png" class="img-fluid"> <br></p>
<p><span class="emoji" data-emoji="eyes">👀</span> This track has shown that our sample transcriptomes follow a normal distribution consistent with the mm10 reference. <br><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Challenge</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we did detect GC bias, how could we customise our run to correct for this?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is a tricky one, particularly if you are unfamiliar with RNAseq analysis!</p>
<ol type="1">
<li>Correcting for GC bias in this analysis requires operation at the transcript quantification step, which is performed by the <code>SALMON_QUANT</code> module</li>
<li>Reading the tool documentation for <code>salmon</code> indicates we need to apply the <a href="https://salmon.readthedocs.io/en/latest/salmon.html#gcbias"><code>--gcBias</code></a> flag</li>
<li>Checking the available nf-core <a href="https://nf-co.re/rnaseq/3.11.1/parameters">parameters for the rnaseq pipeline</a>, we find that there is no nf-core parameter addressing GC bias!</li>
<li>However, the astute observer would discover a parameter <code>--extra_salmon_quant_args</code> with description <em>‘Extra arguments to pass to Salmon quant command in addition to defaults defined by the pipeline’</em>. Sounds perfect, yes?!</li>
<li>We can then provide the required <code>salmon</code> flag (and any others we needed) as an argument to the nf-core <code>--extra_salmon_quant_args</code> parameter, wrapped in quotes, supplying the parameter to the run as we would any other nf-core parameter (either on the command line or within a parameters file):</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a># Within parameters YAML file:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>extra_salmon_quant_args : '--gcBias'</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a># On the command line - note the intentional inclusion of whitespace inside the quotes:</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>--extra_salmon_quant_args '--gcBias '</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br><br></p>
<p><span class="emoji" data-emoji="scream">😱</span> <span style="color:#8b0000;"><strong>What would we do if the above solution was not available within our chosen nf-core pipeline?</strong></span></p>
<p>We will cover this in the next lesson! <span class="emoji" data-emoji="sunglasses">😎</span></p>
<p><br></p>
</section>
<section id="apply-external-arguments" class="level3">
<h3 class="anchored" data-anchor-id="apply-external-arguments"><strong>2.4.4. Apply external arguments</strong></h3>
<p>All nf-core modules are currently required to include the mandatory arguments that a tool needs to run within the <code>main.nf</code> file of the process running that tool.</p>
<p>Optional arguments for a tool that are commonly changed are usually included as nf-core workflow parameters, so they can be easily customised on the command line or supplied within a parameters file.</p>
<p>As we are all aware, bioinformatics tools can have a <em>lot</em> of optional arguments. It is not feasible for nf-core to paramaterise all of these arguments…</p>
<p><img src="../figs/2.4_args_pie_chart.png" class="img-fluid" style="width:50.0%"></p>
<p><br></p>
<p>In this lesson, we will learn how to apply any argument for a tool that is not explicitly covered by an nf-core workflow parameter using Nextflow’s <a href="https://www.nextflow.io/docs/latest/process.html#ext"><code>ext</code> directive</a>. <br><br></p>
<p>➤ Consider the diagram below:</p>
<ul>
<li>On the <strong>left</strong> of the diagram is an example of the standard <code>main.nf</code> format of a process named <code>example</code> stored in the <code>modules</code> directory
<ul>
<li>Above the script block, the <code>$args</code> variable is defined</li>
<li>The <code>task.ext.args ?: ''</code> expression checks if the <code>ext.args</code> parameter has already been defined</li>
<li>If it isn’t defined it will assign an empty string</li>
<li>Inside the script block, the <code>$args</code> variable is applied to the process command</li>
</ul></li>
<li>In the <strong>middle</strong> of the diagram is an example of a custom configuration file targeting the <code>modules/example/main.nf</code> process
<ul>
<li>This configuration file gives the tool argument <code>--flag1</code> to <code>ext.args</code></li>
</ul></li>
<li>On the <strong>right</strong> of the diagram we see how the tool command is executed if <code>-c example-custom.config</code> was applied
<ul>
<li><code>--flag1</code> is interpolated by the <code>$args</code> variable <br><br></li>
</ul></li>
</ul>
<p><img src="../figs/2.5_ext-args.png" class="img-fluid"> <br><br><br></p>
<p>To practice this, we are going to pass an optional flag to the Trim Galore process.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>This workshop was developed <em>before</em> the release of <code>nf-core/rnaseq -r 3.11.0</code>, where the parameter <a href="https://nf-co.re/rnaseq/3.11.1/parameters#extra_trimgalore_args"><code>--extra_trimgalore_args</code></a> was first introduced.</p>
<p>We have retained this exercise as it is equally applicable to other tools which do not have an <code>--extra_&lt;tool&gt;_args</code> nf-core parameter.</p>
<p>This is a good reminder that:</p>
<ul>
<li>nf-core pipelines are under active development</li>
<li>carefully check the parameter and usage docs with each new release</li>
<li>submit feature requests to the nf-core/github pipeline repo to have <code>--extra_&lt;tool&gt;_args</code> added where you think its warranted</li>
</ul>
</div>
</div>
<p><br><br></p>
<p>For the sake of the lesson, let’s assume we want to apply a very stringent minimum Phred score of 40.</p>
<p><span class="emoji" data-emoji="exclamation">❗</span> <em>This is overly stringent! Bear with us…</em> <span class="emoji" data-emoji="blush">😊</span> <br><br></p>
<p>➤ Follow the decision tree to answer some key questions we need to answer to apply this workflow customisation:</p>
<p><img src="../figs/2.4_trimgalore_qual_decision_chart.png" class="img-fluid"> <br><br><br></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Inclusion of ext.args
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall from <a href="../notebooks/2.1_design.html#2.1.2.-desing-your-run-command">Session 2.1</a> that the inclusion of <code>ext.args</code> is currently standard practice for all DSL2 nf-core modules where additional parameters may be required to run a process, however this <em>may not be implemented for all processes</em></p>
</div>
</div>
<p>Following the above exploration, we have learnt that:</p>
<ul>
<li>The Trim Galore argument <code>--quality 40</code> is required to over-ride the Trim Galore default of 20</li>
<li>This parameter is absent from the nf-core/rnaseq parameters list</li>
<li>Only <code>--cores</code> and <code>--gzip</code> are hard-coded in <code>trimgalore/main.nf</code></li>
<li><code>ext.args</code> <strong>is</strong> defined in <code>trimgalore/main.nf</code></li>
</ul>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Challenge</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write a custom configuration file named <code>custom-args.config</code> that adds <code>--quality 40</code> to the script block of the TRIM_GALORE module.</p>
<p><span class="emoji" data-emoji="bulb">💡</span> <strong>Hint:</strong> you may find it helpful to take a copy of the <code>custom-tools.config</code> file from the previous exercise</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb16"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>// A custom configuration file for specifying external tool arguments</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {   </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        ext.args = '--quality 40'</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
<p>➤ Resume the run, specifying our latest custom config file <code>custom-args.config</code> and output directory Lesson-2.4.4:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,custom-tools.config,custom-trace.config,custom-args.config \</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.4 \</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  -resume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
<p><span class="emoji" data-emoji="astonished">😲</span> Pipeline <strong>completed successfully</strong> but <span style="color:#8b0000;"> 2/2 samples failed!</span></p>
<p><img src="../figs/2.4_failed_star.png" class="img-fluid"> <br><br></p>
<p>➤ Investigate the source of the failure:</p>
<p>Following the advice of the warning message, check the MultiQC report by opening the file <code>Lesson-2.4.4/multiqc/star_salmon/multiqc_report.html</code></p>
<ul>
<li>Click on the ‘WARNING: Fail Trimming Check’ on the navigation headings on the left</li>
<li>Both of our samples ‘<em>failed the minimum trimmed reads threshold specified via the <code>--min_trimmed_reads</code> parameter, and hence were ignored for the downstream processing steps</em>’</li>
<li>Looking at the <a href="https://nf-co.re/rnaseq/3.11.1/parameters#min_trimmed_reads"><code>--min_trimmed_reads</code></a> parameter documentation, the default 10,000 and our samples both had &lt; 5,000</li>
</ul>
<p><img src="../figs/2.4_min_trim_param.png" class="img-fluid"> <br><br></p>
<p>➤ Confirm that the external argument was applied to the run:</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>In this example, it is clear that our <code>ext.args</code> customisation was successfully applied because of the catastrophic failure it produced. But in less dramatic cases, how can we confirm that the external argument was actually applied?</p>
</div>
</div>
<ul>
<li>On your <code>multiqc_report.html</code> file, navigate to the section ‘nf-core/rnaseq Workflow Summary’.</li>
<li>Unlike our custom <strong>options</strong>, <strong>profiles</strong>, and <strong>configs</strong>, the custom quality parameter is <strong>not documented!</strong> <br><br></li>
</ul>
<p>Some tools write a handy log, in which case you might view the applied parameters from that file:</p>
<p><img src="../figs/2.4_trimgalore_log.png" class="img-fluid"> <br><br></p>
<p>In the absence of an informative tool log, you can always rely on <code>nextflow log</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nextflow log &lt;run_name&gt; -f script | grep -A 10 trim_galore</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>##</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>#        trim_galore \</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>#            --quality 40 \</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>#            --cores 1 \</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>#            --gzip \</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>#            SRR3473989.fastq.gz</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>##</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Stay vigilant!
</div>
</div>
<div class="callout-body-container callout-body">
<p>This lesson highlights the need to <strong>thoroughly check your output to ensure that the intended anlysis has been run and the results are what you require</strong>.</p>
<p>The message <code>Pipeline completed successfully</code> printed to your terminal everytime a run completes (and also exit status of zero for invidual tasks or cluster jobs if you are running on a cluster) indicates that there were no errors running the pipeline, <strong>not</strong> that your samples have produced the desired output!</p>
</div>
</div>
<p><br><br></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Key points</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>You can customise container use, resource tracing and mutliqc reports through custom configuration files</li>
<li>You can apply tool arguments to an nf-core pipeline using the <code>ext.args</code> feature</li>
<li>You can specify multiple custom configuration files at <code>-c</code> in a comma-delimited list</li>
<li>There is no substitute for reading the tool docs when customising your runs!</li>
</ul>
</div>
</div>


</section>

<p>All materials copyright Sydney Informatics Hub, University of Sydney</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>