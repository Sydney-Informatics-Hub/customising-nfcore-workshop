<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sydney Informatics Hub training - 2.4. Using multiple configuration files at once</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Sydney Informatics Hub training</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup.html">
 <span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notebooks/0.0_welcome.html">
 <span class="menu-text">Lesson plan</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-1">    
        <li>
    <a class="dropdown-item" href="../notebooks/1.0_intro.html">
 <span class="dropdown-text">1.0 Session 1 kick-off</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.1_nextflow.html">
 <span class="dropdown-text">1.1 Introduction to Nextflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.2_nfcore.html">
 <span class="dropdown-text">1.2 Introduction to nf-core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.3_configure.html">
 <span class="dropdown-text">1.3 Configuring nf-core workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.4_users.html">
 <span class="dropdown-text">1.4 Commands for users</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-2">    
        <li>
    <a class="dropdown-item" href="../notebooks/2.0_intro.html">
 <span class="dropdown-text">2.0 Session 2 kick-off</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.1_design.html">
 <span class="dropdown-text">2.1 Design a run command</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.2_params.html">
 <span class="dropdown-text">2.2 Use a parameters file</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.3_configEnv.html">
 <span class="dropdown-text">2.3 Configure resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2.4_multiConfig.html">
 <span class="dropdown-text">2.4 Apply multiple configurations</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../tips_tricks.html">
 <span class="menu-text">Tips &amp; Tricks</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#customised-resource-tracing" id="toc-customised-resource-tracing" class="nav-link active" data-scroll-target="#customised-resource-tracing"><strong>2.4.1. Customised resource tracing</strong></a></li>
  <li><a href="#configure-multiqc-reports" id="toc-configure-multiqc-reports" class="nav-link" data-scroll-target="#configure-multiqc-reports"><strong>2.4.2. Configure MultiQC reports</strong></a></li>
  <li><a href="#configure-your-run-to-use-a-non-default-container" id="toc-configure-your-run-to-use-a-non-default-container" class="nav-link" data-scroll-target="#configure-your-run-to-use-a-non-default-container"><strong>2.4.3. Configure your run to use a non-default container</strong></a></li>
  <li><a href="#apply-external-arguments" id="toc-apply-external-arguments" class="nav-link" data-scroll-target="#apply-external-arguments"><strong>2.4.4. Apply external arguments</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>2.4. Using multiple configuration files at once</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Create and apply custom configuration files for:
<ul>
<li>Customised resource tracing</li>
<li>Bespoke MultiQC report formatting</li>
<li>Over-riding the default container for a tool</li>
<li>Adding tool arguments that are not available as nf-core parameters</li>
</ul></li>
<li>Apply multiple custom configuration files in a single workflow execution with <code>-c &lt;conf-1,conf2,...&gt;</code></li>
</ul>
</div>
</div>
<p>Using multiple configuration files allows you to customise nf-core pipelines to your specific needs, with different configs to each alter the output in some specific way. They can be applied in a <strong>modular</strong> fashion, either added to or dropped from a pipeline execution as required.</p>
<p>This flexibility ensures that we preserve the <strong>portability</strong> and <strong>reproducibility</strong> of nf-core pipelines by <strong>not editing the core workflow code</strong> to make bespoke customisations.</p>
<p>In this lesson we will create four custom configuration files for different customisation scenarios, and apply them to the one run command.</p>
<p>Unlike our institutional config <code>custom-nimbus.config</code>, these configs are <strong>optional</strong> and <strong>portable</strong>:</p>
<ul>
<li>We can apply them only as needed</li>
<li>We can apply them to nf-core runs on any machine</li>
<li>We can apply them to any nf-core pipeline that uses the module the config operates on <br><br></li>
</ul>
<section id="customised-resource-tracing" class="level3">
<h3 class="anchored" data-anchor-id="customised-resource-tracing"><strong>2.4.1. Customised resource tracing</strong></h3>
<p>nf-core pipelines by default create a <a href="https://www.nextflow.io/docs/latest/tracing.html#trace-report">trace report</a> file within <code>&lt;outdir&gt;/pipeline_info</code>. A trace report can be customised to include any combination of <a href="https://www.nextflow.io/docs/latest/tracing.html#trace-fields">available fields</a> using the Nextflow <a href="https://www.nextflow.io/docs/latest/tracing.html#customizing-fields">-f,-fields</a> option.</p>
<p>If there is a specific combination of fields you would like to regularly capture for your pipeline runs, perhaps for <a href="https://www.nature.com/articles/s41467-019-09406-4">resource benchmarking</a>, it would be useful to have a custom configuration file that can be optionally applied to any run, to save having to extract this information later. <br><br></p>
<p>‚û§ View the available fields using the Nextflow <code>log</code> command, or <a href="https://www.nextflow.io/docs/latest/tracing.html#trace-fields">online</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>nextflow log -list-fields</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that percent CPU and percent memory are <code>%cpu%</code> and <code>%mem</code> when used as arguments to the <code>trace</code> option, yet <code>pcpu</code> and <code>pmem</code> for the Nextflow <code>log</code> command. <br><br></p>
<p>‚û§ Use the Nextflow <code>log</code> command with <code>fields</code> option to extract some specific fields for a recent run. Choose any fields you like, and add them in a comma-separated , for example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nextflow log | tail -1</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>nextflow log &lt;run_name&gt; -f name,status,exit,realtime,cpus,pcpu,memory,pmem,rss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
<p>Let‚Äôs make a portable configuration file for resource tracing that we can share with collaborators and use across multiple pipelines <span class="emoji" data-emoji="handshake">ü§ù</span></p>
<p>‚û§ Open a file for editing called <code>custom-trace.config</code> and add the following content. Feel free to list your own set of chosen trace fields rather than the example list below:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>// Custom trace report config</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>// Define timestamp, to avoid overwriting existing trace </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>def trace_timestamp = new java.util.Date().format('yyyy-MM-dd_HH-mm-ss')</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>// Generate custom resource trace file </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>trace {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  enabled = true </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  file = "${params.outdir}/custom-resource-trace-${trace_timestamp}.txt"</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  fields = 'name,status,exit,realtime,cpus,%cpu,memory,%mem,rss'</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ Before submitting your run, delete or comment out the <code>withName: '.*:RNASEQ:ALIGN_STAR:STAR_ALIGN'</code> block we applied in the <code>custom-nimbus.config</code> file</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Comments in Nextflow
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>//</code> for single line comments or <code>/* .. */</code> to comment a block on multiple lines</p>
</div>
</div>
<p><br></p>
<p>‚û§ Save both configs and resume your previous run, adding our second custom config <code>custom-trace.config</code> at <code>-c</code> and setting <code>outdir</code> to <code>Lesson-2.4.1</code>:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Specify multiple configs
</div>
</div>
<div class="callout-body-container callout-body">
<p>When adding multiple custom configs, we supply them to <code>-c</code> in a <strong>comma-delimited list</strong></p>
</div>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,custom-trace.config \</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.1 \</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  -resume </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="emoji" data-emoji="eyes">üëÄ</span> Notice that your multiple custom configurations are listed under <strong>Core Nextflow options</strong> on the launch log printed to the screen: <br><br> <img src="../figs/2.4_screenshot_config_list.png" class="img-fluid"> <br><br></p>
<p>‚û§ Once the workflow has run, take a look at the <code>Lesson-2.4.1/custom-resource-trace-${trace_timestamp}.txt</code> file:</p>
<p><span class="emoji" data-emoji="eyes">üëÄ</span> Notice that while the status is <code>CACHED</code>, the resources reported are from the actual compute required to execute the process, and not the time this execution took to restore the data from cache</p>
<p><img src="../figs/2.4_screenshot_custom_trace.png" class="img-fluid"> <br><br><br></p>
</section>
<section id="configure-multiqc-reports" class="level3">
<h3 class="anchored" data-anchor-id="configure-multiqc-reports"><strong>2.4.2. Configure MultiQC reports</strong></h3>
<p>Many nf-core pipelines use <a href="https://multiqc.info/docs/">MultiQC</a> to aggregate results and statistics output by various bioinformatics tools, helping to summarise experiments containing multiple samples and multiple analysis steps.</p>
<p>MultiQC allows users the flexibility of <a href="https://multiqc.info/docs/reports/customisation/">customising the output reports</a>. nf-core has enabled users to take full advantage of this functionality through the inclusion of the <a href="https://nf-co.re/rnaseq/3.11.1/parameters#multiqc_config"><code>--multiqc_config</code> parameter</a>.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Hidden nf-core parameters
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>--multiqc_config</code> parameter is a <strong>‚Äòhidden param‚Äô!</strong> To see this parameter, you need to apply <code>--show_hidden_params</code> on the command line help, or select <strong>‚ÄòShow hidden params‚Äô</strong> on the nf-core parameters webpage</p>
</div>
</div>
<p><br></p>
<p>We are going to create a custom MultiQC config to:</p>
<ul>
<li>Overlay a <a href="https://multiqc.info/modules/fastqc/#theoretical-gc-content">theoretical GC content track</a> specific for our mm10 reference genome</li>
<li>Add a custom report header <br><br></li>
</ul>
<p>‚û§ Open a file for editing named <code>custom-multiqc-config.yaml</code> and add the following content:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can add any fields under the <code>report_header_info</code> section, as long as you follow the required formatting</p>
</div>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a># Project level information:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>report_header_info:</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  - Contact E-mail: "cali.willet@sydney.edu.au"</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  - Workshop host: "Australian BioCommons"</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  - Workshop title: "Unlocking nf-core - customising workflows for your research"</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  - Workshop URL: https://sydney-informatics-hub.github.io/customising-nfcore-workshop/</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  - Sample data: Mouse RNAseq from https://bmcgenomics.biomedcentral.com/articles/10.1186/s12864-016-2801-4 </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a># Theoretical GC Content:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>fastqc_config:  </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  fastqc_theoretical_gc: "mm10_txome" </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ To the <code>workshop-params.yaml</code> file, add:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>multiqc_config: "custom-multiqc-config.yaml" </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ Make sure both YAML files are saved, then re-run the workflow, applying our customisations for both trace reporting and MultiQC formatting:</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can you construct the <code>run</code> command without viewing the solution below?</p>
<p><span class="emoji" data-emoji="bulb">üí°</span> Think about <strong>nf-core parameters</strong> versus <strong>Nextflow configuration files</strong></p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We do not add <code>custom-multiqc-config.yaml</code> at the Nextflow option <code>-c</code>, because it is a YAML file not a Nextflow config. It is supplied as an argument to the optional <strong>nf-core parameter</strong> <code>multiqc_config</code>. We could specify <code>--multiqc_config custom-multiqc-config.yaml</code> on the command line, but we do not need to here because we have already added that parameter to <code>workshop-params.yaml</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,custom-trace.config \</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.2 \</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  -resume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
<p>‚û§ View the html file <code>Lesson-2.4.2/multiqc/star_salmon/multiqc_report.html</code> and compare it to the report generated by a previous run:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Reminder: Viewing the MultiQC HTML
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>If you are using VS Code with the ‚ÄòLive Server‚Äô extension installed, right click the html file in the Explorer pane and select ‚ÄòOpen with Live Server‚Äô</li>
<li>If you are using a terminal without a browser GUI enabled, use eg <code>scp</code> command to take a copy to your local computer and open in your preferred browser</li>
</ul>
</div>
</div>
<p>Notice your custom report header info at the top of the page:</p>
<p><img src="../figs/2.4_multiqc_custom_header.png" class="img-fluid"> <br></p>
<p>Navigate to the section titled <strong>FastQC: Per Sequence GC Content</strong>. Compare the two plots to observe the custom track has been successfully added.</p>
<p><img src="../figs/2.4_MultiQC.png" class="img-fluid"> <br></p>
<p><span class="emoji" data-emoji="eyes">üëÄ</span> This track has shown that our sample transcriptomes follow a normal distribution consistent with the mm10 reference. <br><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we did detect GC bias, how could we customise our run to correct for this?</p>
<p><span class="emoji" data-emoji="weight_lifting">üèãÔ∏è</span> This is a tricky one, particularly if you are unfamiliar with RNAseq analysis!</p>
<p><span class="emoji" data-emoji="bulb">üí°</span> So here is a freebie to get you started: correcting for GC bias in this analysis requires operation at the transcript quantification step, which is performed by the <code>SALMON_QUANT</code> module</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Check the tool documentation for <code>salmon</code>: we need to apply the <a href="https://salmon.readthedocs.io/en/latest/salmon.html#gcbias"><code>--gcBias</code></a> flag</li>
<li>Check the available nf-core <a href="https://nf-co.re/rnaseq/3.11.1/parameters">parameters for the rnaseq pipeline</a>: we find that there is no nf-core parameter addressing GC bias!</li>
<li>However, the astute observer would discover a parameter <code>--extra_salmon_quant_args</code> with description <em>‚ÄòExtra arguments to pass to Salmon quant command in addition to defaults defined by the pipeline‚Äô</em>. Sounds perfect, yes?!</li>
<li>We can then provide the required <code>salmon</code> flag (and any others we needed) as an argument to the nf-core <code>--extra_salmon_quant_args</code> parameter, wrapped in quotes, supplying the parameter to the run as we would any other nf-core parameter (either on the command line or within a parameters file):</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a># Within parameters YAML file:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>extra_salmon_quant_args : '--gcBias'</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a># On the command line - note the intentional inclusion of whitespace inside the quotes:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>--extra_salmon_quant_args '--gcBias '</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br><br></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
When <code>extra_&lt;tool&gt;_args</code> is not available <span class="emoji" data-emoji="scream">üò±</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>extra_&lt;tool&gt;_args</code> parameter is not available for every tool used in nf-core pipelines. We can supply external tool arguments using an alternate method that we will cover in <a href="2.4_multiConfig.html#apply-external-arguments">lesson 2.4.4</a> <span class="emoji" data-emoji="sunglasses">üòé</span></p>
</div>
</div>
<p><br></p>
</section>
<section id="configure-your-run-to-use-a-non-default-container" class="level3">
<h3 class="anchored" data-anchor-id="configure-your-run-to-use-a-non-default-container"><strong>2.4.3. Configure your run to use a non-default container</strong></h3>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Caveat
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that for deploying nf-core workflows, it is not recommended to replace the tools within the workflow, as this will decrease portability and reproducibilty! This exercise is to demonstrate how you can specify containers, as this may aid you in developing and testing your own Nextflow workflows or testing new tool versions</p>
</div>
</div>
<p>For this example, let‚Äôs assume we want to test out the latest version of <a href="https://github.com/FelixKrueger/TrimGalore">Trim Galore</a>, which is newer than the default version of Trim Galore used by version 3.11.1 of <code>nf-core/rnaseq</code>.</p>
<p>As can often be the case in programming, <a href="https://wiki.treasurers.org/wiki/TIMTOWTDI"><strong>TIMTOWTDI</strong>!</a></p>
<p>Given what you have learnt about custom configuration files so far, take a moment to think about the <strong>optimal method to use</strong> for this customisation.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Thoughts? <span class="emoji" data-emoji="thought_balloon">üí≠</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>For maintaining portability and reproducibility, what is the best way to specify our custom Trim Galore container when we execute the <code>nf-core/rnaseq</code> pipeline?</strong></p>
<p><strong>a.</strong> Within the <code>custom-nimbus.config</code> institutional config file. It‚Äôs already working well on our platform, so we can build on it for further customisations without issue.</p>
<p><strong>b.</strong> Within a separate custom config file named <code>custom-trimgalore-version.config</code>. We would then apply it at <code>-c</code> along with our institutional config whenever it was required.</p>
<p><strong>c.</strong> Within the Trim Galore <code>main.nf</code> file. This way, we don‚Äôt need to worry about adding another custom config when we execute the <code>run</code> command.</p>
</div>
</div>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the event that we are testing a different tool version, this should <strong>not</strong> be placed within the institutional config that is shareable with others using nf-core pipelines on the same infrastructure. Doing so would prevent our institutional config from being portable to other analyses.</p>
<p>In general, editing the process <code>main.nf</code> file is <strong>not</strong> recommended, as this impedes reproducibility. Swapping out tool versions is a bespoke adaptation of the nf-core workflow that would harm reproducibility if it was inadvertently executed, which is likely to happen if it is hidden within the source code.</p>
<p>By placing it within a clearly named custom config file, there is less chance of unwittingly executing a workflow that does not match the expected utilisation of tools. Whenever we run an nf-core pipeline, the custom configs we applied are listed under <strong>Core Nextflow options</strong> in the run log, so there is a record that the particular configuration file was applied. Take care to <strong>save</strong> any custom configuration files applied to a run along with the project outputs, and to <strong>use an informative config name</strong>.</p>
</div>
</div>
</div>
<p><br></p>
<p>‚û§ Identify the default version of Trim Galore that has been used in our runs so far from the <code>software_versions.yml</code> file:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Versions of all tools used in nf-core pipelines are reported in the default output file <code>&lt;outdir&gt;/pipeline_info/software_versions.yml</code></li>
<li>This information is also shown in the ‚Äònf-core/rnaseq Software Versions‚Äô section of the MultiQC html report<br>
</li>
<li>The module names are listed in alphabetical order, with the tools and versions used by the process listed below each module</li>
</ul>
</div>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>more Lesson-2.4.2/pipeline_info/software_versions.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>TRIMGALORE:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  cutadapt: '3.4'</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  trimgalore: 0.6.7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
If you have not yet run this version of the pipeline
</div>
</div>
<div class="callout-body-container callout-body">
<p>‚Ä¶and thus do not have a <code>software_versions.yaml</code> or MultiQC report to check, one way to discover the default tool version is to look in the process <code>main.nf</code> file:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>grep container nf-core-rnaseq-3.11.1/workflow/modules/nf-core/trimgalore/main.nf </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    container "${ workflow.containerEngine == 'singularity' &amp;&amp; !task.ext.singularity_pull_docker_container ?</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>        'quay.io/biocontainers/trim-galore:0.6.7--hdfd78af_0' }"</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This should not often be the case, as nf-core pipelines should first be run with a test dataset <em>before</em> executing your full run and delving into custom configuration.</p>
<p>nf-core pipelines ship with <code>test</code> datasets to enable easy testing on your infrastructure with eg <code>nextflow run &lt;workflow&gt; -profile singularity,test</code></p>
</div>
</div>
<p><br></p>
<p>‚û§ Identify the container path for Trim Galore v. 0.6.10 hosted at CernVM-FS:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Biocontainers at cvmfs
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pawsey have cached the Biocontainers tool repository at <code>/cvmfs/singularity.galaxyproject.org</code>. Tools are organised alphabetically into subdirectories, eg <code>/cvmfs/singularity.galaxyproject.org/t/r/</code> for Trim Galore.</p>
</div>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ls /cvmfs/singularity.galaxyproject.org/t/r/trim*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>/cvmfs/singularity.galaxyproject.org/t/r/trim-galore:0.6.10--hdfd78af_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ Next, identify the execution path for the TRIMGALORE module:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>grep -i galore nf-core-rnaseq-3.11.1/workflow/conf/modules.config </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>    if (params.trimmer == 'trimgalore') {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>            withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:FASTQC' {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    if (params.trimmer == 'trimgalore') {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>            withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                        params.extra_trimgalore_args ? params.extra_trimgalore_args.split("\\s(?=--)") : ''</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ Open a file for editing named <code>custom-trimgalore-version.config</code>, and start building your config with the <code>process</code> scope and <code>withName</code> selector that we covered in <a href="2.3_configEnv.html#custom-resource-configuration-using-process-names">lesson 2.3.5</a>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>// Config to test out newer trimgalore</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  withName: {</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ Then copy the TRIMGALORE module execution path from your terminal inside the <code>withName</code> block:</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure to copy the module path for TRIMGALORE and not FASTQC which are both within the same SUBWORKFLOW</p>
</div>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ Finally, add the container details inside the <code>withName</code> block:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>Other remote container sources can be used, such as <a href="https://quay.io/organization/biocontainer">quay.io</a>, or point to a local image if your machine does not have internet access</p>
</div>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    container = '/cvmfs/singularity.galaxyproject.org/t/r/trim-galore:0.6.10--hdfd78af_0' </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>‚û§ Save <code>custom-trimgalore-version.config</code> then resume the previous run, supplying our <strong>three</strong> configuration files at <code>-c</code> and specifying <code>--outdir Lesson-2.4.3</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,custom-trace.config,custom-trimgalore-version.config \</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.3 \</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  -resume </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<span class="emoji" data-emoji="hourglass">‚åõ</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Because we have altered a pre-processing step, read trimming and all downstream steps will need to be re-computed. Our run will take ~ 10 minutes to complete.</p>
<p>For now we will skip forward to the next lesson and check on the results of this lesson a little later.</p>
<p>Leave the <code>run</code> command running in your terminal, and open a new terminal (if you are in VS Code, do this by clicking the <code>+</code> icon in the top right corner of your terminal)</p>
<p>Run the <code>nextflow log</code> command with no arguments. Observe that this command is applicable to the working directory, not the session.</p>
</div>
</div>
<p><br><br></p>
<p>‚û§ After your run has completed, check that the updated version of Trim Galore has been used:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>grep -i galore Lesson-2.4.3/pipeline_info/software_versions.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>TRIMGALORE:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  trimgalore: 0.6.10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>grep -i galore Lesson-2.4.2/pipeline_info/software_versions.yml </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>TRIMGALORE:</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  trimgalore: 0.6.7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
</section>
<section id="apply-external-arguments" class="level3">
<h3 class="anchored" data-anchor-id="apply-external-arguments"><strong>2.4.4. Apply external arguments</strong></h3>
<p>Mandatory minimum arguments that a tool needs to run are hard-coded within the <code>main.nf</code> file of the nf-core module.</p>
<p>Optional arguments for a tool that are commonly changed are usually included as nf-core workflow parameters, so they can be easily customised on the command line or supplied within a parameters file.</p>
<p>As we are all aware, bioinformatics tools can have a <em>lot</em> of optional arguments. It is not feasible for nf-core to paramaterise all of these arguments‚Ä¶</p>
<p><img src="../figs/2.4_args_pie_chart.png" class="img-fluid" style="width:40.0%"></p>
<p><br></p>
<p>In this lesson, we will learn how to apply any argument for a tool that is not explicitly covered by an nf-core workflow parameter using Nextflow‚Äôs <a href="https://www.nextflow.io/docs/latest/process.html#ext"><code>ext</code> directive</a>. <br><br></p>
<p>‚û§ Consider the diagram below:</p>
<ul>
<li>On the <strong>left</strong> of the diagram is an example of the standard <code>main.nf</code> format of a process named <code>example</code> stored in the <code>modules</code> directory
<ul>
<li>Above the script block, the <code>$args</code> variable is defined</li>
<li>The <code>task.ext.args ?: ''</code> expression checks if the <code>ext.args</code> parameter has already been defined</li>
<li>If it isn‚Äôt defined it will assign an empty string</li>
<li>Inside the script block, the <code>$args</code> variable is applied to the tool command</li>
</ul></li>
<li>In the <strong>middle</strong> of the diagram is a custom configuration file targeting the ‚ÄòEXAMPLE‚Äô process
<ul>
<li>This configuration file gives the tool-specific argument <code>--flag1</code> to <code>ext.args</code> using <code>withName</code></li>
</ul></li>
<li>On the <strong>right</strong> of the diagram we see how the tool command is executed if <code>-c example-custom.config</code> was applied to the run
<ul>
<li>The <code>$args</code> variable is interpolated to <code>--flag1</code> when <code>modules/example/main.nf</code> is executed <br><br></li>
</ul></li>
</ul>
<p><img src="../figs/2.5_ext-args.png" class="img-fluid"> <br><br></p>
<p><span class="emoji" data-emoji="eyes">üëÄ</span> You can observe the empty <code>$args</code> variable at play within <code>.command.sh</code> scripts for a run:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>nextflow log </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>nextflow log &lt;run_name&gt; -f script</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="emoji" data-emoji="hourglass">‚åõ</span> Before we continue, time for a quick check back on the <code>Lesson-2.4.3</code> run!</p>
</div>
</div>
<p><br><br></p>
<p>We will now pass an optional flag to the Trim Galore process using <code>ext.args</code> in a custom configuration file.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Disclaimer <span class="emoji" data-emoji="hand_over_mouth">ü§≠</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>This workshop was developed <em>before</em> the release of <code>nf-core/rnaseq</code> revision 3.11.0, where the parameter <a href="https://nf-co.re/rnaseq/3.11.1/parameters#extra_trimgalore_args"><code>--extra_trimgalore_args</code></a> was first introduced.</p>
<p>We have retained this exercise as it is equally applicable to other tools which <em>do not</em> have an <code>--extra_&lt;tool&gt;_args</code> nf-core parameter.</p>
<p>This is a good reminder that:</p>
<ul>
<li>nf-core pipelines are under active development</li>
<li>carefully check the parameter and usage docs with each new release</li>
<li>submit feature requests to the nf-core/github pipeline repo to have <code>--extra_&lt;tool&gt;_args</code> added where you think it‚Äôs warranted</li>
</ul>
</div>
</div>
<p><br><br></p>
<p>For the sake of the lesson, let‚Äôs assume we want to apply a very stringent minimum Phred score of 40. This is overly stringent! Bear with us‚Ä¶ <span class="emoji" data-emoji="blush">üòä</span> <br><br></p>
<p>‚û§ Follow the decision tree to work out how to apply this workflow customisation. Some useful links are below the flowchart:</p>
<p><img src="../figs/2.4_trimgalore_qual_decision_chart.png" class="img-fluid"> <br><br></p>
<p><span class="emoji" data-emoji="toolbox">üß∞</span> <a href="https://github.com/FelixKrueger/TrimGalore/blob/master/Docs/Trim_Galore_User_Guide.md#general-options">Trim Galore docs</a></p>
<p><span class="emoji" data-emoji="toolbox">üß∞</span> <a href="https://nf-co.re/rnaseq/3.11.1/parameters#read-trimming-options">nf-core/rnaseq trimming params v.3.11.1</a> vs <a href="https://nf-co.re/rnaseq/3.10.1/parameters#read-trimming-options">v.3.10.1</a></p>
<p><span class="emoji" data-emoji="toolbox">üß∞</span> <a href="https://github.com/nf-core/rnaseq/blob/3.11.1/modules/nf-core/trimgalore/main.nf">Trim Galore <code>main.nf</code></a> <br></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Inclusion of ext.args
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall from <a href="2.1_design.html#design-your-run-command">lesson 2.1.2</a> that the inclusion of <code>ext.args</code> is currently standard practice for all DSL2 nf-core modules where additional parameters may be required to run a process, however this <em>may not be implemented for all processes</em></p>
</div>
</div>
<p><br></p>
<p>From the above investigation, we have learnt that:</p>
<ul>
<li>The Trim Galore argument <code>--quality 40</code> is required to over-ride the Trim Galore default of 20</li>
<li>This parameter is absent from the <code>nf-core/rnaseq</code> parameters list (for v.3.10.1 that is!) <span class="emoji" data-emoji="blush">üòä</span></li>
<li>Only <code>--cores</code>, <code>--gzip</code> and input file are hard-coded in <code>trimgalore/main.nf</code></li>
<li><code>ext.args</code> <strong>is</strong> defined in <code>trimgalore/main.nf</code></li>
</ul>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Challenge</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write a custom configuration file named <code>custom-trimgalore-args.config</code> that adds <code>--quality 40</code> to the script block of the TRIMGALORE module</p>
<p><span class="emoji" data-emoji="weight_lifting">üèãÔ∏è</span> Try to write the config without showing the solution!</p>
<p><span class="emoji" data-emoji="bulb">üí°</span> <strong>Hint:</strong> you may find it helpful to take a copy of the <code>custom-trimgalore-version.config</code> file from the previous exercise</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb26"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>// A custom configuration file for specifying external tool arguments to Trim Galore</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    withName: '.*:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE' {   </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        ext.args = '--quality 40'</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
<p>‚û§ Save <code>custom-trimgalore-args.config</code> then resume your run, adding our latest custom config file to the growing list at <code>-c</code> and set <code>outdir</code> param to <code>Lesson-2.4.4</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core-rnaseq-3.11.1/workflow/main.nf \</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  -profile workshop \</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  -c custom-nimbus.config,custom-trace.config,custom-trimgalore-version.config,custom-trimgalore-args.config \</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  --outdir Lesson-2.4.4 \</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  -resume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
<p><span class="emoji" data-emoji="astonished">üò≤</span> Pipeline <strong>completed successfully</strong> but <span style="color:#8b0000;"> 2/2 samples failed!</span></p>
<p><img src="../figs/2.4_failed_star.png" class="img-fluid"> <br><br></p>
<p>‚û§ Investigate the source of the failure:</p>
<ul>
<li><p>Following the advice of the warning message, check the MultiQC report by opening the file <code>Lesson-2.4.4/multiqc/star_salmon/multiqc_report.html</code> (with Live Server VS Code extension or taking a local copy)</p></li>
<li><p>Click on the ‚ÄòWARNING: Fail Trimming Check‚Äô on the navigation headings on the left</p></li>
<li><p>Both of our samples ‚Äú<em>failed the minimum trimmed reads threshold specified via the <code>--min_trimmed_reads</code> parameter, and hence were ignored for the downstream processing steps</em>‚Äù</p></li>
<li><p>Looking at the <code>nf-core/rnaseq</code> parameter documentation, we see <a href="https://nf-co.re/rnaseq/3.11.1/parameters#min_trimmed_reads"><code>--min_trimmed_reads</code> param</a> with default value 10,000. Our samples both had &lt; 5,000 reads</p></li>
<li><p>Comparing the outputs in <code>Lesson-2.4.4</code> to a previous run, notice there is no <code>star_salmon</code> directory. These modules did not have their input channels fulfilled by the previous modules in the workflow, so they were not executed.<br>
<br><br></p></li>
</ul>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Stay vigilant!
</div>
</div>
<div class="callout-body-container callout-body">
<p>This lesson highlights the need to <strong>thoroughly check your output to ensure that the intended anlysis has been run and the results are what you require</strong>.</p>
<p>The message <code>Pipeline completed successfully</code> printed to your terminal every time a run completes (and also exit status of zero for individual tasks and cluster jobs) indicates that there were no errors running the pipeline, <strong>not</strong> that your run has produced the desired output!</p>
</div>
</div>
<p><br></p>
<p>In this example, it is clear that our <code>ext.args</code> customisation was successfully applied because of the catastrophic failure it produced. In less dramatic cases, <strong>how can we confirm that the external argument was actually applied?</strong> <span class="emoji" data-emoji="thinking">ü§î</span></p>
<p>‚û§ Confirm that the external argument was actually applied:</p>
<p>Within your MultiQC report, navigate to the section <strong>‚Äònf-core/rnaseq Workflow Summary‚Äô</strong>. Unlike our custom <strong>options</strong>, <strong>profiles</strong>, and <strong>configs</strong>, the custom quality parameter is <strong>not documented!</strong></p>
<p>Some tools write a handy log, in which case you might view the applied parameters from that file, eg:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>head Lesson-2.4.4/trimgalore/SRR3473988.fastq.gz_trimming_report.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../figs/2.4_trimgalore_log.png" class="img-fluid"> <br><br></p>
<p>In the absence of an informative tool log, you can always rely on <code>nextflow log</code> <span class="emoji" data-emoji="smiling_face_with_three_hearts">ü•∞</span></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nextflow log &lt;run_name&gt; -f script | grep -A 10 trim_galore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>trim_galore \</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  --quality 40 \</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  --cores 1 \</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  --gzip \</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  SRR3473989.fastq.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
<p>‚û§ <strong>Optional final run for the purists at heart <span class="emoji" data-emoji="angel">üëº</span></strong></p>
<p>If you would like to conclude today‚Äôs compute with a successful run, try changing the Trim Galore <code>--quality</code> threshold to 30. <br><br><br></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Key points</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>You can customise resource tracing, mutliqc report format and container use through custom configuration files</li>
<li><code>ext</code> is a very handy Nextflow directive that has been enabled by nf-core to provide full tool functionality for end users through <code>ext.args</code> in custom configs</li>
<li>You can specify multiple custom configuration files at the Nextflow option <code>-c</code> in a comma-delimited list</li>
<li>Appropriate custom config use provides <strong>modularity, portability and reproducibility</strong> to nf-core workflows</li>
<li><strong>There is no substitute for reading the tool docs when customising your runs!</strong> <span class="emoji" data-emoji="book">üìñ</span></li>
</ul>
</div>
</div>


</section>

<div style="font-size: 14px;">
All materials copyright Sydney Informatics Hub, University of Sydney
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>