---
title: '**Configuring nf-core workflows**'
output:
  html_document:
    toc: false
    toc_float: false
from: markdown+emoji
---

nf-core workflows follow a set of best practices and standardized conventions. The structure of an nf-core workflow is designed to be modular, easily customizable, and reproducible. Although you wonâ€™t need to edit the code base to run an nf-core workflow, having a basic understanding of the repository structure will help you understand how to configure its execution.

# Configuration hierarchy

When a workflow is launched, Nextflow will look for configuration files in multiple locations. As each configuration file can contain conflicting settings, the sources are ranked to decide which settings to are applied.

Configuration sources are reported below and listed in order of priority:

1. Parameters specified on the command line (`--parameter`)
2. Parameters that are provided using the `-params-file` option
3. Config file specified using the `-c` option
4. The config file named `nextflow.config` in the current directory
5. The config file named `nextflow.config` in the workflow project directory
6. The config file `$HOME/.nextflow/config`
7. Values defined within the workflow script itself (e.g., `main.nf`)

Notably, while some of these files are included in the nf-core repository by default (e.g., `nextflow.config`), others are external to the code base and are included using `run` options (e.g., `-c` and `-params-file`).

# nf-core workflow structure

nf-core workflows start from a common template and follow the same structure.

![](../figs/1.3_structure.excalidraw.png)

To make workflows flexible, the parameters used to configure nf-core workflows are stored in different files in different locations. Although many of these configuration files are loaded automatically at runtime, you can choose to include or exclude others.

The purposes of these files and how they are used are described in greater detail below.

## nextflow.config

For nf-core workflows, the `nextflow.config` contains parameter defaults.

Additionally, inside the `nextflow.config`, several `includeConfig` statements are used to specify additional `.config` files from the `conf/` folder. Each additional `.config` file contains categorized configuration information for your workflow execution:

- `base.config`
  - Loaded by default.
  - Generous resource allocations using labels.
  - Does not specify any method for software management and expects software to be available (or specified elsewhere).
- `igenomes.config`
  - Loaded by default.
  - Default configuration to access reference files stored on AWS iGenomes.
- `modules.config`
  - Loaded by default.
  - Module-specific configuration options (both mandatory and optional).
- `test.config`
  - Only included if specified as a profile.
  - A configuration profile to test the workflow with a small test dataset.
- `test_full.config`
  - Only included if specified as a profile.
  - A configuration profile to test the workflow with a full-size test dataset.

## Config profiles

Configuration files can also contain the definition of one or more profiles. A profile is a set of configuration attributes that can be activated when launching a workflow by using the `-profile` command option:

```bash
nextflow run nf-core/<workflow> -profile <profile>
```

Profiles used by nf-core workflows include:

- Software management profiles
  - Profiles for the management of software using software management tools, e.g., `docker`, `singularity`, and `conda`.
- Test profiles
  - Profiles to execute the workflow with a standardized set of test data and parameters, e.g., `test` and `test_full`.

Multiple profiles can be specified in a comma-separated list when you execute your command. The order of profiles is important as they will be read from left to right:

```bash
nextflow run nf-core/<workflow> -profile test,docker
```

By default, nf-core workflows are required to define software containers and conda environments that can be activated using profiles. In theory, it is possible to run the workflows with software installed by other methods (e.g., environment modules or manual installation). However, this is not recommended and most people find Docker or Singularity containers to be the most convenient and reproducible.

Additionally, `includeConfig` is used in the `nextflow.config` file to include custom institutional profiles that have been submitted to the nf-core [config repository](https://github.com/nf-core/configs). At run time, nf-core workflows will fetch these configuration profiles from the remote configs repository and make them available.

For shared resources such as an HPC cluster, you may consider developing a shared institutional profile. You can follow [this tutorial](https://nf-co.re/docs/usage/tutorials/step_by_step_institutional_profile) for more help.

# Parameters and config files

You can also configure an nf-core workflow without modifying the workflow codebase. You can be clever with configuration hierarchy to create flexible deployment options for different situations. Taking the time to understand each file type and its place in the hierarchy is critical to flexibly deploy nf-core workflows.

Workflow parameters can be overridden using either the command line or configuration files.

Every nf-core workflow has a full list and description of parameters on the nf-core website. Some parameters will also have additional help text to help you understand when and how a parameter should be used.

Any script parameter can be specified on the command line by prefixing the parameter name with two dash (`--`) characters:

```bash
nextflow nf-core/<workflow> -profile test,docker --<parameter>
```

It can be messy and difficult to specify every parameter every time you want to run a workflow. You will likely find that it is much easier and more reproducible to write custom `.config` or `.json` files that can be included using the `-c` and `-param-file` options, respectively.

Parameter files are `.json` that can contain an unlimited number of parameters:

```bash
{
   "<parameter1_name>": 1,
   "<parameter2_name>": "<string>",
   "<parameter3_name>": true
}
```

You can override default parameters by creating a custom `.json` file and passing it as a command-line argument using the `-param-file` option.

As described in [Introduction to nf-core](1.2_nfcore.md), nf-core workflows already contain multiple `.config` files that can contain settings and parameters.

Although these `.config` files are already being used to set defaults you can override them using a custom `.config` file and passing it as a command-line argument using the `-c` option.

```bash
nextflow run nf-core/<workflow> -profile test,docker -c custom.config
```

Configuration settings are organized into scopes by dot prefixing the property names with a scope identifier or grouping the properties in the same scope using the curly brackets notation. For example:

```bash
alpha.x  = 1
alpha.y  = 'string value..'
```

Is equivalent to:

```bash
alpha {
     x = 1
     y = 'string value..'
}
```

Of special importance, the `process` scope allows you to configure workflow processes.

Modules in nf-core workflows make use of labels. By default, process resources are allocated in the `conf/base.config` file using the `withLabel` selector. For example:

```bash
process {
    withLabel: big_mem {
        cpus = 16
        memory = 64.GB
    }
}
```

Similarly, the `withName` selector allows the configuration of a specific process by its name. By default, module parameters are defined in the `conf/modules.config` file. For example:

```bash
process {
    withName: HELLO {
        cpus = 4
        memory = 8.GB
    }
}
```

Most tool arguments are defined in the `conf/modules.conf` file in the workflow code under the `ext.args` entry.

For example, if you were trying to overwrite arguments in the `TRIMGALORE` process in the `nf-core/rnaseq` workflow you could use the process scope:

```bash
process {
    withName : ".*:TRIMGALORE" {
        ext.args   = { "<your custom parameter>" }
    }
```

In other cases, a workflow may use a tool multiple times in the workflow. In this case, you will need to specify the whole execution path of the module. For example:

```bash
process {
    withName: "NFCORE_RNASEQ:RNASEQ:FASTQ_FASTQC_UMITOOLS_TRIMGALORE:TRIMGALORE" {
        ext.args = "<your custom parameter>"
    }
}
```

::: callout-warning

A `--params-file` must be used to define parameters.

Parameters that are defined in the parameter block in `custom.config` files **WILL NOT** override defaults in `nextflow.config` for nf-core workflows.

:::

A full list of configuration scopes can be found [here](https://www.nextflow.io/docs/latest/config.html#config-scopes).